<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>PACK (git.Git__.Store.PACK)</title><link rel="stylesheet" href="../../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../../index.html">git</a> &#x00BB; <a href="../../index.html">Git__</a> &#x00BB; <a href="../index.html">Store</a> &#x00BB; PACK</nav><h1>Module type <code>Store.PACK</code></h1></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type of the <i>packed</i> Git object.</p></dd></dl><dl><dt class="spec type" id="type-state"><a href="#type-state" class="anchor"></a><code><span class="keyword">type</span> state</code></dt><dd><p>The type for the state of a Git store.</p></dd></dl><dl><dt class="spec type" id="type-value"><a href="#type-value" class="anchor"></a><code><span class="keyword">type</span> value</code></dt><dd><p>The type of the Git values.</p></dd></dl><dl><dt class="spec module" id="module-FS"><a href="#module-FS" class="anchor"></a><code><span class="keyword">module</span> <a href="FS/index.html">FS</a> : <a href="../../S/index.html#module-type-FS">Git__.S.FS</a></code></dt><dd><p>The <code>FS</code> module used to make the implementation.</p></dd></dl><dl><dt class="spec module" id="module-Hash"><a href="#module-Hash" class="anchor"></a><code><span class="keyword">module</span> <a href="Hash/index.html">Hash</a> : <a href="../../S/index.html#module-type-HASH">Git__.S.HASH</a></code></dt><dd><p>The <code>Hash</code> module used to make the implementation.</p></dd></dl><dl><dt class="spec module" id="module-Inflate"><a href="#module-Inflate" class="anchor"></a><code><span class="keyword">module</span> <a href="Inflate/index.html">Inflate</a> : <a href="../../S/index.html#module-type-INFLATE">Git__.S.INFLATE</a></code></dt><dd><p>The <code>Inflate</code> module used to make the implementation.</p></dd></dl><dl><dt class="spec module" id="module-Deflate"><a href="#module-Deflate" class="anchor"></a><code><span class="keyword">module</span> <a href="Deflate/index.html">Deflate</a> : <a href="../../S/index.html#module-type-DEFLATE">Git__.S.DEFLATE</a></code></dt><dd><p>The <code>Deflate</code> module used to make the implementation.</p></dd></dl><div class="spec module" id="module-HDec"><a href="#module-HDec" class="anchor"></a><code><span class="keyword">module</span> <a href="HDec/index.html">HDec</a> : <a href="../../../Git/Unpack/index.html#module-type-H">Git.Unpack.H</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-H/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="spec module" id="module-PDec"><a href="#module-PDec" class="anchor"></a><code><span class="keyword">module</span> <a href="PDec/index.html">PDec</a> : <a href="../../../Git/Unpack/index.html#module-type-P">Git.Unpack.P</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-P/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-P/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-P/Hunk/index.html">Hunk</a> := <a href="index.html#module-HDec">HDec</a></code></div><div class="spec module" id="module-RPDec"><a href="#module-RPDec" class="anchor"></a><code><span class="keyword">module</span> <a href="RPDec/index.html">RPDec</a> : <a href="../../../Git/Unpack/index.html#module-type-D">Git.Unpack.D</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-D/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-D/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-D/Hunk/index.html">Hunk</a> := <a href="index.html#module-HDec">HDec</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-D/Pack/index.html">Pack</a> := <a href="index.html#module-PDec">PDec</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Unpack/module-type-D/Mapper/index.html">Mapper</a> := <a href="FS/index.html#module-Mapper">FS.Mapper</a></code></div><div class="spec module" id="module-PEnc"><a href="#module-PEnc" class="anchor"></a><code><span class="keyword">module</span> <a href="PEnc/index.html">PEnc</a> : <a href="../../../Git/Pack/index.html#module-type-P">Git.Pack.P</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Pack/module-type-P/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Pack/module-type-P/Deflate/index.html">Deflate</a> := <a href="index.html#module-Deflate">Deflate</a></code></div><div class="spec module" id="module-IDec"><a href="#module-IDec" class="anchor"></a><code><span class="keyword">module</span> <a href="IDec/index.html">IDec</a> : <a href="../../../Git/Index_pack/index.html#module-type-LAZY">Git.Index_pack.LAZY</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Index_pack/module-type-LAZY/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="spec module" id="module-IEnc"><a href="#module-IEnc" class="anchor"></a><code><span class="keyword">module</span> <a href="IEnc/index.html">IEnc</a> : <a href="../../../Git/Index_pack/index.html#module-type-ENCODER">Git.Index_pack.ENCODER</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Index_pack/module-type-ENCODER/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a></code></div><div class="spec module" id="module-PInfo"><a href="#module-PInfo" class="anchor"></a><code><span class="keyword">module</span> <a href="PInfo/index.html">PInfo</a> : <a href="../../../Git/Pack_info/index.html#module-type-S">Git.Pack_info.S</a> <span class="keyword">with</span> <span class="keyword">module</span> <a href="../../../Git/Pack_info/module-type-S/Hash/index.html">Hash</a> := <a href="index.html#module-Hash">Hash</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Pack_info/module-type-S/Inflate/index.html">Inflate</a> := <a href="index.html#module-Inflate">Inflate</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Pack_info/module-type-S/HDec/index.html">HDec</a> := <a href="index.html#module-HDec">HDec</a> <span class="keyword">and</span> <span class="keyword">module</span> <a href="../../../Git/Pack_info/module-type-S/PDec/index.html">PDec</a> := <a href="index.html#module-PDec">PDec</a></code></div><dl><dt class="spec type" id="type-error"><a href="#type-error" class="anchor"></a><code><span class="keyword">type</span> error</code></dt></dl><dl><dt class="spec value" id="val-lookup"><a href="#val-lookup" class="anchor"></a><code><span class="keyword">val</span> lookup : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#module-Hash">Hash</a>.t * <span>(Checkseum.Crc32.t * int64)</span>)</span> option</span> Lwt.t</span></code></dt><dd><p><code>lookup state hash</code> tries to find the object associated by the hash <code>hash</code> in all <i>IDX</i> files available in the current git repository <code>state</code>. This function returns <code>None</code> if the Git object does not exist in any <i>IDX</i> files or it does not exists in the current repository.</p></dd></dl><dl><dt class="spec value" id="val-mem"><a href="#val-mem" class="anchor"></a><code><span class="keyword">val</span> mem : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>mem state hash</code> is true iff there is an object such that <code>digest(object)
      = hash</code>. This function is the same as <code>lookup state hash &lt;&gt; None</code>.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span><span><a href="index.html#module-Hash">Hash</a>.t list</span> Lwt.t</span></code></dt><dd><p><code>list state</code> is the list of all the <i>packed</i> Git object noticed by all <i>IDX</i> files available in the current git repository <code>state</code>. Errors are ignored and skipped.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-value">value</a>, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>read state hash</code> can retrieve a git <i>packed</i> object from any <i>PACK</i> files available in the current git repository <code>state</code>. It just inflates the git object and informs some meta-data (like kind, CRC-32 check-sum, length, etc.) about it. Then, the client can use the related decoder to get the OCaml value.</p><p>This function allocates 2 <code>Cstruct.t</code> needed to re-construct the git <i>packed</i> object in any case (if it is delta-ified or not) and a certain amount of little buffer (sized by 0x7F bytes) to help the construction only when the requested object is delta-ified.</p><p>Can return an <a href="index.html#type-error"><code>error</code></a>:</p><ul><li><a href="FS/File/index.html#type-error"><code>FS.File.error</code></a> or <a href="FS/Dir/index.html#type-error"><code>FS.Dir.error</code></a> or <a href="FS/Mapper/index.html#type-error"><code>FS.Mapper.error</code></a> when we retrieve a file-system error</li><li><span class="xref-unresolved" title="unresolved reference to &quot;PACKDecoder.error&quot;"><code>PACKDecoder</code>.error</span> when we retrieve an error about the decoding of the <i>packed</i> git object in the founded <i>PACK</i>i file</li><li><span class="xref-unresolved" title="unresolved reference to &quot;IDXDecoder.error&quot;"><code>IDXDecoder</code>.error</span> when we retrieve an error about the decoding of an <i>IDX</i> file</li><li><code>`Not_found</code> when the requested object is not <i>packed</i></li></ul></dd></dl><dl><dt class="spec value" id="val-size"><a href="#val-size" class="anchor"></a><code><span class="keyword">val</span> size : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#module-Hash">Hash</a>.t <span>&#45;&gt;</span> <span><span><span>(int, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>size state hash</code> returns the size of the git <i>packed</i> object which respects the predicate <code>digest(object) = hash</code>. The size is how many byte(s) are needed to store the serialized (but not inflated) git object in bytes (without the header).</p><p>As for <a href="index.html#val-read"><code>read</code></a>, <a href="index.html#val-size"><code>size</code></a> can return an <a href="index.html#type-error"><code>error</code></a>.</p></dd></dl><dl><dt class="spec type" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span class="keyword">type</span> stream</code><code> = unit <span>&#45;&gt;</span> <span><span>Cstruct.t option</span> Lwt.t</span></code></dt><dd><p>The stream contains the PACK flow.</p></dd></dl><dl><dt class="spec value" id="val-from"><a href="#val-from" class="anchor"></a><code><span class="keyword">val</span> from : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <a href="index.html#type-stream">stream</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#module-Hash">Hash</a>.t * int, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>from git stream</code> populates the Git repository <code>git</code> from the PACK flow <code>stream</code>. If any error is encountered, any Git objects of the PACK flow are not added in the Git repository.</p></dd></dl><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <a href="index.html#type-state">state</a> <span>&#45;&gt;</span> <span>?&#8288;window:<span>[ <span>`Object of int</span> <span><span>| `Memory</span> of int</span> ]</span></span> <span>&#45;&gt;</span> <span>?&#8288;depth:int</span> <span>&#45;&gt;</span> <span><a href="index.html#type-value">value</a> list</span> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#type-stream">stream</a> * <span><span><span>(Checkseum.Crc32.t * int64)</span> <a href="Hash/index.html#module-Map">Hash.Map</a>.t</span> Lwt_mvar.t</span>, <a href="index.html#type-error">error</a>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>make ?window ?depth values</code> makes a PACK stream from a list of <span class="xref-unresolved" title="unresolved reference to &quot;Value.t&quot;"><a href="../../index.html#module-Value"><code>Value</code></a>.t</span>.</p><p><code>?window</code> specifies the weight of the window while the delta-ification. The client can limit the weight by the number of objects in the windoz (by default, is 10) or by the weight in byte of the window in your memory.</p><p><code>depth</code> (default is <code>50</code>) limits the depth of the delta-ification.</p><p>Then, the function returns a stream and a protected variable which contains a representation of the associated IDX file of the PACK stream. This protected variable is available (<code>Lwt_mvar.take</code>) only <b>at the end</b> of the PACK stream. That means, the client needs to consume all of the stream and only then he can take the <code>Graph.t</code> associated.</p></dd></dl></div></body></html>